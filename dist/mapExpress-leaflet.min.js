/*! mapExpress-leaflet 08-10-2015 */
MapExpress={Controls:{},Data:{},Geo:{},Layers:{},Utils:{},Mapping:{}},"undefined"!=typeof window&&window.L&&(window.MapExpress=MapExpress),function(){"use strict";MapExpress.Data.MapSourceProvider=L.Class.extend({statics:{},options:{},initialize:function(a){},getFeatureInfo:function(a){}}),MapExpress.Data.mapSourceProvider=function(a){return new MapExpress.Data.MapSourceProvider(a)}}.call(this),function(){"use strict";MapExpress.Data.RasterProvider=MapExpress.Data.MapSourceProvider.extend({initialize:function(a,b){MapExpress.Data.MapSourceProvider.prototype.initialize.call(this,b),L.setOptions(this,b),this._imageUrl=a},getMapImageUrl:function(a,b){return this._imageUrl}}),MapExpress.Data.rasterProvider=function(a,b){return new MapExpress.Data.RasterProvider(a,b)}}.call(this),function(){"use strict";MapExpress.Data.TileProvider=MapExpress.Data.MapSourceProvider.extend({options:{maxZoom:23,subdomains:"abc"},initialize:function(a,b){MapExpress.Data.MapSourceProvider.prototype.initialize.call(this,b),L.setOptions(this,b),this._url=a,"string"==typeof this.options.subdomains&&(this.options.subdomains=this.options.subdomains.split(""))},getTileImage:function(a){var b=new Image;return b.src=this.getTileUrl(a),b},getTileUrl:function(a){return L.Util.template(this._url,L.extend({r:this.options.tileCoord&&L.Browser.retina&&this.options.maxZoom>0?"@2x":"",s:this._getSubdomain(a),x:a.x,y:a.y,z:a.z},this.options))},_getSubdomain:function(a){var b=Math.abs(a.x+a.y)%this.options.subdomains.length;return this.options.subdomains[b]}}),MapExpress.Data.tileProvider=function(a,b){return new MapExpress.Data.TileProvider(a,b)}}.call(this),function(){"use strict";MapExpress.Data.WmsProvider=MapExpress.Data.MapSourceProvider.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/png",transparent:!1},options:{tileSize:256,crs:L.CRS.EPSG3857,uppercase:!1,maxZoom:23,subdomains:"abc"},initialize:function(a,b){MapExpress.Data.MapSourceProvider.prototype.initialize.call(this,b),this._url=a;var c=L.extend({},this.defaultWmsParams);for(var d in b)d in this.options||(c[d]=b[d]);b=L.setOptions(this,b),c.width=c.height=b.tileSize*(b.detectRetina&&L.Browser.retina?2:1),this.wmsParams=c},getTileImage:function(a){var b=this._tileCoordsToBounds(a),c=this.options.tileSize,d=new L.Point(c,this.options.tileSize);return this.getMapImage(b,d)},getMapImage:function(a,b){var c=new Image;return c.src=this.getMapImageUrl(a,b),c},getMapImageUrl:function(a,b){var c=parseFloat(this.wmsParams.version),d=this.options.crs,e=c>=1.3?"crs":"srs",f=d.project(a.getNorthWest()),g=d.project(a.getSouthEast()),h={width:b.x,height:b.y};h[e]=d.code,h.bbox=(c>=1.3&&d===L.CRS.EPSG4326?[g.y,f.x,f.y,g.x]:[f.x,g.y,g.x,f.y]).join(","),L.extend(this.wmsParams,h);var i=this.options.uppercase||!1,j=L.Util.getParamString(this.wmsParams,this._url,i);return this._url+j},_tileCoordsToBounds:function(a){var b=this.options.tileSize,c=L.CRS.EPSG3857,d=new L.Point(a.x*b,a.y*b),e=new L.Point(d.x+b,d.y+b),f=c.pointToLatLng(d,a.z),g=c.pointToLatLng(e,a.z),h=c.wrapLatLng(f),i=c.wrapLatLng(g);return new L.LatLngBounds(h,i)}}),MapExpress.Data.wmsProvider=function(a,b){return new MapExpress.Data.WmsProvider(a,b)}}.call(this),function(){"use strict";MapExpress.Layers.RasterSourceLayer=L.ImageOverlay.extend({initialize:function(a,b,c){this._rasterProvider=a;var d=this._rasterProvider.getMapImageUrl(b,this._map.getSize());L.ImageOverlay.prototype.initialize.call(this,d,b,c)}}),MapExpress.Layers.rasterSourceLayer=function(a,b,c){return new MapExpress.Layers.RasterSourceLayer(a,b,c)}}.call(this),function(){"use strict";MapExpress.Layers.TileServiceLayer=L.TileLayer.extend({initialize:function(a,b){L.TileLayer.prototype.initialize.call(this,null,b),this.tileProvider=a},createTile:function(a,b){var c=this.getTileImage(a);return L.DomEvent.on(c,"load",L.bind(this._tileOnLoad,this,b,c)),L.DomEvent.on(c,"error",L.bind(this._tileOnError,this,b,c)),this.options.crossOrigin&&(c.crossOrigin=""),c.alt="",c},getTileImage:function(a){return this.tileProvider.getTileImage(a)}}),MapExpress.Layers.tileServiceLayer=function(a,b){return new MapExpress.Layers.TileServiceLayer(a,b)}}.call(this),function(){"use strict";MapExpress.Layers.WmsImageOverlayLayer=L.ImageOverlay.extend({initialize:function(a,b){this._wmsProvider=a,L.ImageOverlay.prototype.initialize.call(this,null,null,b)},getEvents:function(){var a={zoom:this._reset,viewreset:this._reset,moveend:this._reset};return this._zoomAnimated&&(a.zoomanim=this._animateZoom),a},_reset:function(){this._updateImage(),L.ImageOverlay.prototype._reset.call(this)},_updateImage:function(){this._bounds=this._map.getBounds(),this._url=this._wmsProvider.getMapImageUrl(this._bounds,this._map.getSize()),L.DomUtil.remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image),this._initImage(),this.options.opacity<1&&this._updateOpacity(),this.options.interactive&&(L.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image)}}),MapExpress.Layers.wmsImageOverlayLayer=function(a,b){return new MapExpress.Layers.WmsImageOverlayLayer(a,b)}}.call(this);